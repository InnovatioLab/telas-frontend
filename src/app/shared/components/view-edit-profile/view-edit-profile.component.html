<div class="profile-container">
  <div class="profile-header">
    <h1 class="profile-title">Profile Settings</h1>
  </div>

  <div class="profile-content" *ngIf="!loading; else loadingTemplate">
    <form [formGroup]="profileForm">
      <div class="section-title">Company Information</div>
      <div class="form-row">
        <div class="form-group">
          <label for="businessName">Business Name</label>
          <input
            type="text"
            id="businessName"
            formControlName="businessName"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="identificationNumber">Identification Number</label>
          <input
            type="text"
            id="identificationNumber"
            formControlName="identificationNumber"
            [disabled]="true"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="industry">Industry</label>
          <input
            type="text"
            id="industry"
            formControlName="industry"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="websiteUrl">Website</label>
          <input
            type="text"
            id="websiteUrl"
            formControlName="websiteUrl"
            [readonly]="!isEditMode"
          />
        </div>
      </div>

      <div class="section-title">Contact</div>
      <div class="form-row">
        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="phone">Phone</label>
          <p-inputMask
            mask="+1 999 999 9999"
            formControlName="phone"
            placeholder="+1 508 215 8681"
            id="phone"
            [readonly]="!isEditMode"
            class="w-full"
          >
          </p-inputMask>
          <div
            *ngIf="
              profileForm.get('phone')?.invalid &&
              (profileForm.get('phone')?.dirty ||
                profileForm.get('phone')?.touched)
            "
          >
            <small
              class="error-message"
              *ngIf="profileForm.get('phone')?.errors?.['required']"
            >
              Phone is required.
            </small>
            <small
              class="error-message"
              *ngIf="profileForm.get('phone')?.errors?.['pattern']"
            >
              Phone must have 11 digits (numbers only).
            </small>
          </div>
        </div>
      </div>

      <div class="section-title">Owner Information</div>
      <div class="form-row">
        <div class="form-group">
          <label for="ownerFirstName">Owner First Name</label>
          <input
            type="text"
            id="ownerFirstName"
            formControlName="ownerFirstName"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="ownerLastName">Owner Last Name</label>
          <input
            type="text"
            id="ownerLastName"
            formControlName="ownerLastName"
            [readonly]="!isEditMode"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="ownerEmail">Owner Email</label>
          <input
            type="email"
            id="ownerEmail"
            formControlName="ownerEmail"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="ownerPhone">Owner Phone</label>
          <p-inputMask
            mask="+1 999 999 9999"
            formControlName="ownerPhone"
            placeholder="+1 508 215 8681"
            id="ownerPhone"
            [readonly]="!isEditMode"
            class="w-full"
          >
          </p-inputMask>
        </div>
      </div>

      <div class="section-title">Address</div>
      <div class="form-row">
        <div class="form-group">
          <label for="street">Street</label>
          <input
            type="text"
            id="street"
            formControlName="street"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="zipCode">ZIP Code</label>
          <input
            type="text"
            id="zipCode"
            formControlName="zipCode"
            [readonly]="!isEditMode"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="city">City</label>
          <input
            type="text"
            id="city"
            formControlName="city"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="state">State</label>
          <input
            type="text"
            id="state"
            formControlName="state"
            [readonly]="!isEditMode"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="country">Country</label>
          <input
            type="text"
            id="country"
            formControlName="country"
            [readonly]="!isEditMode"
          />
        </div>

        <div class="form-group">
          <label for="complement">Complement</label>
          <input
            type="text"
            id="complement"
            formControlName="complement"
            [readonly]="!isEditMode"
          />
        </div>
      </div>

      <div class="section-title">Social Media</div>

      <div formArrayName="socialMedia">
        <div class="social-media-header">
          <label>Social Media Links</label>
          <button
            *ngIf="isEditMode"
            type="button"
            class="btn-add-social"
            (click)="addSocialMedia()"
          >
            <icon-plus></icon-plus>
            Add Social Media
          </button>
        </div>

        <div
          *ngIf="socialMediaArray.length === 0 && !isEditMode"
          class="no-social-media"
        >
          No social media links added.
        </div>

        <div
          *ngIf="socialMediaArray.length === 0 && isEditMode"
          class="no-social-media-edit"
        >
          <p>
            No social media links added yet. Click the button above to add your
            first social media link.
          </p>
        </div>

        <div
          *ngFor="let social of socialMediaArray.controls; let i = index"
          [formGroupName]="i"
          class="form-row social-media-row"
        >
          <div class="form-group">
            <p-dropdown
              [options]="socialMediaOptions"
              formControlName="platform"
              placeholder="Select Social Media"
              [disabled]="!isEditMode"
              class="w-full social-dropdown"
            >
            </p-dropdown>
            <app-error
              *ngIf="
                social.get('platform')?.touched &&
                social.get('platform')?.invalid
              "
              [control]="social.get('platform')"
            ></app-error>
          </div>

          <div class="form-group">
            <input
              type="url"
              formControlName="url"
              placeholder="https://www.example.com"
              [readonly]="!isEditMode"
              class="w-full input-form"
            />
            <app-error
              *ngIf="social.get('url')?.touched && social.get('url')?.invalid"
              [control]="social.get('url')"
            ></app-error>
          </div>

          <button
            pButton
            icon="pi pi-trash"
            *ngIf="isEditMode"
            type="button"
            class="btn-remover-social p-button-danger ml-2 icon-button btn-danger"
            (click)="removeSocialMedia(i)"
          >
            <!-- <i class="pi pi-trash"></i> -->
          </button>
        </div>
      </div>

      <div class="button-container">
        <ng-container *ngIf="!isEditMode">
          <button pButton class="btn-edit" (click)="toggleEditMode()">
            Edit
          </button>
        </ng-container>
        <ng-container *ngIf="isEditMode">
          <button
            pButton
            class="btn-cancel"
            id="btnSecundario"
            (click)="cancelEdit()"
          >
            Cancel
          </button>
          <button pButton class="btn-save" (click)="saveProfile()">Save</button>
        </ng-container>
      </div>
    </form>
  </div>

  <ng-template #loadingTemplate>
    <div class="loading-indicator">
      <p>Loading profile information...</p>
    </div>
  </ng-template>
</div>
