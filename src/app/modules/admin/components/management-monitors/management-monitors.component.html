<div class="container">
  <div class="content">
    <p-card styleClass="card-header">
      <div class="card-header-content">
          <i class="pi pi-search"></i>
          <div class="p-card-content">
            <span class="p-input-icon-left">
              <app-icon-search></app-icon-search>
              <input 
                type="text" 
                pInputText 
                placeholder="Search monitors..." 
                [(ngModel)]="searchTerm"
                (keyup.enter)="onSearch()" />
            </span>
            <p-button label="Create Monitor" icon="pi pi-plus" (click)="openCreateMonitorModal()"></p-button>
          </div>
      </div>
    </p-card>

    <p-table 
      [value]="monitors" 
      [loading]="loading" 
      styleClass="p-datatable-sm" 
      [paginator]="true" 
      [rows]="currentFilters?.size || 10" 
      [totalRecords]="totalRecords"
      [rowsPerPageOptions]="[5,10,25,50]" 
      [showCurrentPageReport]="true" 
      responsiveLayout="scroll"
      [lazy]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} monitors"
      (onPage)="onPageChange($event)"
      (onSort)="onSort($event)"
      [sortField]="currentFilters?.sortBy || 'active'"
      [sortOrder]="currentFilters?.sortDir === 'asc' ? 1 : -1">
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="id">ID <p-sortIcon field="id"></p-sortIcon></th>
          <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
          <th pSortableColumn="status">Status <p-sortIcon field="status"></p-sortIcon></th>
          <th pSortableColumn="lastUpdate">Last Update <p-sortIcon field="lastUpdate"></p-sortIcon></th>
          <th>Actions</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-monitor>
        <tr>
          <td>{{monitor.id}}</td>
          <td>{{monitor.name}}</td>
          <td>
            <p-badge [value]="monitor.status" [severity]="monitor.status === 'active' ? 'success' : 'danger'"></p-badge>
          </td>
          <td>{{monitor.lastUpdate | date:'medium'}}</td>
          <td>
            <div class="action-buttons">
              <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success p-button-text" 
                      (click)="onSelectMonitor(monitor)"></button>
              <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger p-button-text" 
                      (click)="deleteMonitor(monitor.id)"></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center">No monitors found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Modal de criação de monitor -->
  <p-dialog 
    [(visible)]="createMonitorModalVisible" 
    [modal]="true" 
    [style]="{width: '90vw', maxWidth: '800px', height: '90vh'}" 
    [draggable]="false"
    [resizable]="false"
    [closeOnEscape]="true"
    [dismissableMask]="true"
    [showHeader]="false"
    [contentStyle]="{'padding': '0', 'border-radius': '8px', 'overflow': 'hidden'}">
    
    <app-create-monitor-modal
      #createMonitorModal
      (close)="onCreateMonitorModalClose()"
      (monitorCreated)="onMonitorCreated($event)">
    </app-create-monitor-modal>
  </p-dialog>

  <p-dialog header="Edit Monitor Details" [(visible)]="dialogVisible" [style]="{width: '600px'}" [modal]="true">
    <div class="monitor-form" *ngIf="selectedMonitor">
      <div class="p-grid p-fluid">
        <div class="p-field p-col-12 p-md-6">
          <label for="name">Name*</label>
          <input type="text" pInputText id="name" [(ngModel)]="selectedMonitor.name" required />
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="productId">Product ID*</label>
          <input type="text" pInputText id="productId" [(ngModel)]="selectedMonitor.productId" required />
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="size">Size (inches)*</label>
          <p-inputNumber id="size" [(ngModel)]="selectedMonitor.size" [min]="1" [max]="200"></p-inputNumber>
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="type">Type*</label>
          <p-dropdown id="type" [options]="[
            {label: 'Basic', value: 'BASIC'}, 
            {label: 'Advanced', value: 'ADVANCED'}, 
            {label: 'Premium', value: 'PREMIUM'}
          ]" [(ngModel)]="selectedMonitor.type" optionLabel="label" optionValue="value"></p-dropdown>
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="status">Status*</label>
          <p-dropdown id="status" [options]="[
            {label: 'Active', value: 'active'}, 
            {label: 'Inactive', value: 'inactive'}
          ]" [(ngModel)]="selectedMonitor.status" optionLabel="label" optionValue="value"></p-dropdown>
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="active">Active</label>
          <p-inputSwitch [(ngModel)]="selectedMonitor.active"></p-inputSwitch>
        </div>
        
        <div class="p-field p-col-12">
          <label for="locationDescription">Location Description</label>
          <textarea pInputTextarea id="locationDescription" [(ngModel)]="selectedMonitor.locationDescription" rows="3"></textarea>
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="maxBlocks">Max Blocks</label>
          <p-inputNumber id="maxBlocks" [(ngModel)]="selectedMonitor.maxBlocks" [min]="1" [max]="100"></p-inputNumber>
        </div>
        
        <div class="p-field-checkbox p-col-12">
          <p-divider></p-divider>
          <h4>Address</h4>
        </div>
        
        <div class="p-field p-col-12">
          <label for="street">Street*</label>
          <input type="text" pInputText id="street" [(ngModel)]="selectedMonitor.address.street" required />
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="city">City*</label>
          <input type="text" pInputText id="city" [(ngModel)]="selectedMonitor.address.city" required />
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="state">State*</label>
          <input type="text" pInputText id="state" [(ngModel)]="selectedMonitor.address.state" required />
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="country">Country*</label>
          <input type="text" pInputText id="country" [(ngModel)]="selectedMonitor.address.country" required />
        </div>
        
        <div class="p-field p-col-12 p-md-6">
          <label for="zipCode">Zip Code*</label>
          <input type="text" pInputText id="zipCode" [(ngModel)]="selectedMonitor.address.zipCode" required />
        </div>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="updateMonitor(selectedMonitor)"></button>
    </ng-template>
  </p-dialog>
</div>
